

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
<head><title>
	
    
    Code Blog Foo: dynamic-asp.net-mvc-part-2

</title><link href="../Content/base.css" rel="stylesheet" type="text/css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    
    <script src="../../Scripts/shAll.js" type="text/javascript"></script>
    <link href="../../Content/SyntaxHighlighter.css" rel="stylesheet" type="text/css" />
</head>
<body>
<strong>This is an archive of blog posts from a "long time ago".  If you find this useful, let me know and I'll revive it.</strong>
    <div class="wrap">
        
        <div id="top group">
            <header>
                <h1>code blog foo - tag line bar</h1>
            </header>
            <div style="padding: 5px; border-bottom: 1px solid silver; border-top: 1px solid silver;">
                <nav>
                    <a href="/" style="margin-left: 15px; border-style: solid; border-width: 1px;">home</a>
                    <span class="sep"></span>
                    <a href="/Blog/Posts" style="margin-left: 15px; border-style: solid; border-width: 1px;">blog</a>
                    <a href="/Home/About" style="margin-left: 15px; border-style: solid; border-width: 1px;">about</a>
                    <a href="/Home/Portfolio" style="margin-left: 15px; border-style: solid; border-width: 1px;">projects/open source</a>
                </nav>
            </div>
        </div>
        
        <div class="content">
            
    
    
    <script type="text/javascript">
        window.onload = function () {
            SyntaxHighlighter.config.clipboardSwf = '/Scripts/clipboard.swf';
            SyntaxHighlighter.all();
            dp.SyntaxHighlighter.HighlightAll('code');
        };

     </script>
    <h2>Dynamic ASP.NET MVC - Part 2, Creating a Better "Compiler"</h2>

<ul>
<li>
<a href="dynamic-asp.net-mvc">TOC</a>
</li>
<li>
<a href="dynamic-asp.net-mvc-part-1">Part 1, Setting Up Your Environment</a>
</li>
<li>
<a href="dynamic-asp.net-mvc-part-2">Part 2, Creating a Better "Compiler"</a>
</li>
<li>
<a href="dynamic-asp.net-mvc-part-3">Part 3, Your First Failing Test</a>
</li>
<li>
<a href="dynamic-asp.net-mvc-part-4">Part 4, Dynamic Data Access</a>
</li>
<li>
<a href="dynamic-asp.net-mvc-part-5">Part 5, Dynamic Data to Views</a>
</li>
<li>
<a href="dynamic-asp.net-mvc-part-6">Part 6, Mixing in Behavior</a>
</li>
<li>
<a href="dynamic-asp.net-mvc-part-7">Part 7, Oak Projections in Massive</a>
</li>
</ul>

<h2>Putting a Bunch of Stuff Together to Make Something Valuable</h2>
<p>
  NuGet is awesome (and so is the .Net Community for submitting packages). It will allow us to put a few code bits together and create something really powerful.  I'm going to walk through a test driven implementation for a blog engine.  We'll start with setting up our solution and nuget packages.
</p>

<h3>Initial Setup of the Blog Solution</h3>
<p>
  There are going to be a few NuGet packages that will be hooked together for this solution to come together.  Let's set up our MVC Application...I'll explain what all this stuff is later in the blog post.
</p>

<h4>Create a New ASP.NET MVC 3 Application</h4>
<p>
<strong>First thing to do is create an empty MVC 3 application </strong> (I called my DynamicBlog).  Nothing special here, just a blank ASP.NET MVC 3 application.  We'll then need to install 3 NuGet packages.  <strong>Open the NuGet Package Manager Console and execute the following commands:</strong>
</p>
<ul>
    <li>install-package rake-dot-net</li>
    <li>install-package specwatchr</li>
    <li>install-package oak</li>
</ul>

<h4>Add HomeController.cs and Index.cshtml</h4>
<p>
   <strong>We need a simple landing page for now.  Add a HomeController with an Index View</strong>.  Pretty straight forward hopefully.  Just create a HomeController.cs with an Index() method that returns a view.
</p>

<h4>Create a .Net 4.0 Class Library for Tests</h4>
<p>
    <strong>Next, create a .Net 4.0 Class Library</strong> (not an MSTest project or anything, just a regular class library...I called my DynamicBlog.Tests).  You'll want to also reference the mvc project, reference System.Web.Mvc and reference System.Web (we'll need that when we start testing our controllers). <strong>Open the NuGet Package Manager Console, select the test project from the Default Project drop down and execute the following command:</strong> 
</p>

<ul>
    <li>install-package nspec</li>
</ul>

<h4>Rake Configuration</h4>
<p>
  <strong>The NuGet package rake-dot-net added a file to your solution folder called dev.yml, open it and set the following variables to reflect your project names:</strong>
</p>

<ul>
    <li>website_port: (you really don't need to change this variable unless you already have something running on this port)</li>
    <li>website_deploy_directory: (this is the directory IISExpress will look at when running your web app...your compiled mvc app will be deployed to this location)</li>
    <li>solution_name: (the name for your solution)</li>
    <li>mvc_project: (folder name of your mvc project)</li>
    <li>test_project: (folder name of your test project)</li>
    <li>test_runner: (you won't have to change this, but if you want to use an older version of NSpec, you can specify it here)</li>
    <li>iis_express: this is the location of your iis express install, if you have a 32-bit system, you'll need to change this value</li>
</ul>

<h4>Ready. To. Rock</h4>
<p>
   All done.  <strong>By following the steps above, you've automated a large part of the development process.</strong>  To demonstrate:
</p>
<ul>
    <li>start up Growl for Windows</li>
    <li>open "Start Command Prompt for Ruby" and navigate to your solution directory</li>
    <li>execute the following command: <strong>rake</strong></li>
    <li>if everything was configured correctly, you should see a build occur and a deployment of the web app occur</li>
    <li>execute the following command: <strong>rake server</strong></li>
    <li>this command will start IISExpress pointed to the directory you provided in the Rake Configuration</li>
    <li>execute the following command: <strong>start http://localhost:3000/Home/Index</strong>
    <li>port 3000 was the default port defined in Rakefile.rb, if you changed that, then remember to use that port instead</li>
    <li>you should see your HomeController's Index.cshtml page</li>
    <li>execute the following command: <strong>sidekick.bat</strong></li>
    <li>you should see watchr start up</li>
    <li>go to your Index.cshtml page and change the html</li>
    <li>watchr will rebuild your solution and redeploy the app, you'll see a growl message when that's done</li>
    <li>refresh the website (you should see these changes show up)</li>
</ul>
<blockquote>
<strong>Hold up...this automation is cool and all, but I thought this blog post was about making ASP.NET MVC dynamic??</strong>
</blockquote>
<p>
   Because we are going to be using a lot of dynamic stuff, we are going to be completely bypassing the compiler for a large portion of the application.  We need something that gives us an immediate feedback loop that is <del>similar to</del> <strong>better than</strong> the compiler.  Our feedback loop for this dynamic website will be our test suite, rake, and specwatchr (sidekick.bat).  The steps we took above was to create a highly specialized "compiler".
</p>
<blockquote>
  <strong>Ummm...so you are saying that we just spent this time creating a specialized "compiler"??  That's a lot of work, especially since a statically typed language already comes with that.</strong>
</blockquote>

<p>
  Think of it this way, the C# compiler is just a really crappy set of unit tests.  On top of that, the compiler isn't here to tell developers what they are doing wrong in the development of their application, it's there to notify developers of what they need to do to <i>appease</i> a statically typed language.  The tests that we write will help us design our application, and communicate intent of the code (as opposed to just telling us that we misspelled something...or that we are calling a method that doesn't exist).
</p>

<p>
   <b>But you know what, you're right, it does take a lot of work to get started. Let's reduce that friction</b>.  Go ahead and delete everything you just did and do the following.  <b>You heard me :-) go ahead and delete the entire solution (directory included).</b>
</p>

<ul>
  <li>Open up a command prompt that supports ruby.</li>
  <li>run the following command (you only have to install this gem once): <b>gem install warmup</b></li>
  <li>Using the command prompt, navigate to where you want your solution folder to be created</li>
  <li>Type the following command: <br/> <b>warmup http://github.com/amirrajan/Loam <i>DynamicBlog</b></i></li>
  <li><b>cd</b> into the directory that you specified in the warmup command</li>
  <li>open the solution, run: <b>rake, rake server, then sidekick.bat</b></li>
  <li>Done.</li>
</ul>

<p>
  Easy huh? Your solution is created, boot strapped with Oak, connection strings added, test project created, build automation is setup, and the dev.yml is updated too.  One simple command.  Makes you wonder why Visual Studio doesn't support something like this out of the box :-).
</p>
    <hr />
    <span style="color: Silver; font-size: small;">Written: 6/18/2011</span>
    
    <script>
        var idcomments_acct = '6ed8d3f7f3b269a55fc308e535627d11';
        var idcomments_post_url;

        var  idcomments_post_id;// = 'http%3A%2F%2Famirrajan.net%2FBlogs%2F' + 'dynamic-asp.net-mvc-part-2';

    </script>
    <span id="IDCommentsPostTitle" style="display:none">Comments</span>
    <script type='text/javascript' src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>
    <script>$("#body").append('<div></div>').html(idcomments_post_id);</script>

        </div>
    </div>
</body>
</html>
